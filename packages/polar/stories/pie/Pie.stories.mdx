import { ArgsTable, Canvas, Meta, Source, Story } from '@storybook/addon-docs'
import { Label } from '@chsk/core'
import { Pie, Origin, Slices } from '../../src'
import { ChartDecorator } from '../decorators'
import { commonPieProps } from './decorators'

# Pie

<Meta title="Addons/Polar/Pie/Pie" />

export const Template = args => <Pie {...args} />

`Pie` sets up a view for a pie or doughnut chart.

<ArgsTable of={Pie} />

## Data

Data should be prepared as an array of objects. All objects should contain a string identifier `id` and a numeric field `data`.

The pseudocode below shows one data item with an identifier and one numeric value.

<Source
    language="javascript"
    code={`
[
  {
    "id": "alpha",
    "data": 55,
  },
  ...
]
`}
/>

## Coordinate system

Consistently with the `View` component in `@chsk/core` (and other view components in add-on packages such as
`Scatter` in `@chsk/xy`), the `Pie` component creates a view in which the svg/absolute position [0, 0]
corresponds to the top-left corner of the view. This convention enables charts to place
elements on the chart in the same way as in other views. For example, a default `Typography` component should appear
in the top-left corner, and a `Surface` component should create a background rectangle that fills the view.

Many components specific to the `Pie` view, however, assume a different convention.
Indeed, they assume that the point [0, 0] in svg coordinates coincides with [0, 0] defined by the
x- and y- scales within the view. To meet this assumption, use `Origin` as a child component.

## Radii

Props `rInner` and `rOuter` determine the radii of slices.
Default values are `rInner=0` and `rOuter=1`, which create slices for a pie chart.
To create a doughnut, set `rInner` to a non-zero value.

<Canvas>
    <Story
        name="pie"
        args={{
        ...commonPieProps,
            rInner: 0,
            rOuter: 1,
             children: (
                            <Origin>
                                <Slices />
                            </Origin>
                        ),
        }}

        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
    <Story
        name="doughnut"
        args={{
        ...commonPieProps,
            rInner: 0.6,
            rOuter: 1,
             children: (
                            <Origin>
                                <Slices />
                            </Origin>
                        ),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>

</Canvas>

Prop `rOuter` determines the overall scale.

<Canvas>
    <Story
        name="scaled"
        args={{
            ...commonPieProps,
            rInner: 0.4,
            rOuter: 0.6,
            children: (
                <Origin>
                    <Slices />
                </Origin>
            ),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

(An alternative way to scale the pie is with the view scale prop `scaleR`).

## Orientation

By default `Pie` processed data so that the first data slice aligns with the vertical axis.
Prop `angle` rotates the whole chart around its center.

<Canvas>
    <Story
        name="rotated"
        args={{
            ...commonPieProps,
            angle: Math.PI / 2,
            children: (
                <Origin>
                    <Slices />
                </Origin>
            ),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

## Alignment

Prop `angleAlign` adjusts the orientation of the chart in a data-dependent way.
The default value (zero) makes the leading edge of first slice align with the global chart angle.
A value of one instead aligns the other edge of the first slice.
Intermediate values are possible as well.

<Canvas>
    <Story
        name="right-aligned"
        args={{
            ...commonPieProps,
            angleAlign: 1,
            children: (
                <Origin>
                    <Slices />
                </Origin>
            ),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
    <Story
        name="center-aligned"
        args={{
            ...commonPieProps,
            angleAlign: 0.5,
            children: (
                <Origin>
                    <Slices />
                </Origin>
            ),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

## Center

The center of a pie or doughnut is always at `[0, 0]`.

<Canvas>
    <Story
        name="center label"
        args={{
            ...commonPieProps,
            rInner: 0.8,
            children: (
                <Origin>
                    <Slices rInner={0.6} />
                    <Label position={[0, 0]} style={{ fontSize: '18px', fontWeight: 600 }}>
                        Label
                    </Label>
                </Origin>
            ),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

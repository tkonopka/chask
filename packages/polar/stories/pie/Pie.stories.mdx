import { ArgsTable, Canvas, Meta, Source, Story } from '@storybook/addon-docs'
import { Surface, Label } from '@chsk/core'
import { Pie, Origin, Slices } from '../../src'
import { ChartDecorator } from '../decorators'
import { commonPieProps, OriginAndSlices } from './decorators'

# Pie

<Meta title="Addons/Polar/Pie/Pie" />

export const Template = args => <Pie {...args} />

`Pie` sets up a view for a pie or doughnut chart.

<ArgsTable of={Pie} />

## Data

Data should be prepared as an array of objects. All objects should contain a string identifier `id` and a numeric field `data`.

The pseudocode below shows one data item with an identifier and one numeric value.

<Source
    language="javascript"
    code={`
[
  {
    "id": "alpha",
    "data": 55,
  },
  ...
]
`}
/>

## Radii

Props `rInner` and `rOuter` determine the radii of slices.
Default values are `rInner=0` and `rOuter=1`, which create slices for a pie chart.
To create a doughnut, set `rInner` to a non-zero value.

<Canvas>
    <Story
        name="pie"
        args={{
        ...commonPieProps,
            rInner: 0,
            rOuter: 1,
            children: (<OriginAndSlices />),
        }}

        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
    <Story
        name="doughnut"
        args={{
        ...commonPieProps,
            rInner: 0.6,
            rOuter: 1,
            children: (<OriginAndSlices />),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>

</Canvas>

Prop `rOuter` determines the outer radius of the pie, and thus sets an overall scale.

<Canvas>
    <Story
        name="scaled"
        args={{
            ...commonPieProps,
            rInner: 0.4,
            rOuter: 0.6,
            children: <OriginAndSlices />,
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

An alternative way to adjust the overall scale is via props `scaleX` and `scaleY` (see below).

## Scales

Although `Pie` manages data meant for a polar layout, the `Pie` view actually uses linear x- and y- scales
to map cartesian coordinates to svg coordinates. (The `useScales` hook returns linear scales.)

Props `scaleX` and `scaleY` specify cartesian linear scale.
In contrast to other views, however, `Pie` adjusts the specified domains in order to ensure that
the chart coordinate system appears with a 1:1 aspect ratio in svg coordinates.

<Canvas>
    <Story
        name="wide x domain"
        args={{
            ...commonPieProps,
            scaleX: {
                variant: 'linear',
                domain: [-3, 3],
            },
            children: (
                <>
                    <Surface />
                    <OriginAndSlices />
                </>
            ),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
    <Story
        name="non-central origin"
        args={{
            ...commonPieProps,
            scaleY: {
                variant: 'linear',
                domain: [0, 2],
            },
            children: (
                <>
                    <Surface />
                    <OriginAndSlices />
                </>
            ),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

## Orientation

By default `Pie` processed data so that the first data slice aligns with the vertical axis.
Prop `angle` rotates the whole chart around its center.
The value can be specified in degrees or radians, with the unit specified in prop `angleUnit`.

<Canvas>
    <Story
        name="rotated"
        args={{
            ...commonPieProps,
            angle: Math.PI / 2,
            angleUnit: 'radian',
            children: <OriginAndSlices />,
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

## Alignment

Prop `angleAlign` adjusts the orientation of the chart in a data-dependent way.
The default value (zero) makes the leading edge of first slice align with the global chart angle.
A value of one instead aligns the other edge of the first slice.
Intermediate values are possible as well.

<Canvas>
    <Story
        name="right-aligned"
        args={{
            ...commonPieProps,
            angleAlign: 1,
            children: <OriginAndSlices />,
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
    <Story
        name="center-aligned"
        args={{
            ...commonPieProps,
            angleAlign: 0.5,
            children: <OriginAndSlices />,
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

## Center

The center of a pie or doughnut is always at `[0, 0]` in the view's cartesian coordinate system.

<Canvas>
    <Story
        name="center label"
        args={{
            ...commonPieProps,
            rInner: 0.8,
            children: (
                <Origin>
                    <Slices rInner={0.6} style={{ fillOpacity: 1 }} />
                    <Label position={[0, 0]} style={{ fontSize: '18px', fontWeight: 600 }}>
                        Label
                    </Label>
                </Origin>
            ),
        }}
        component={Pie}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

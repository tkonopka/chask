import { ArgsTable, Canvas, Meta, Source, Story } from '@storybook/addon-docs'
import { Axis, Legend } from '@chsk/core'
import { Histogram, HistogramArea, HistogramCurve } from '../../src'
import { ChartDecorator, ChartWithLegendSpaceDecorator, sampleData } from './decorators'

# Histogram

<Meta title="Addons/XY/Histograms/Histogram" />
export const Template = args => <Histogram {...args} />

`Histogram` sets up a view for a scatter plot.

`Histogram` is an organizational component and it does not actually draw any visual elements. However, it manages data representations that can be visualized with other components, for example `HistogramPoints` or `HistogramCurve`.

<ArgsTable of={Histogram} />

## Data

Data should be prepared as an array of objects. Each object should contain a string identifier `'id'` and an array `data` with numeric values. The pseudocode below demonstrates the required format.

<Source
    language="javascript"
    code={`
[
  {
    "id": "alpha",
    "data": [ 0.5, 2.5, -0.2, ...]
  },
  ...
]
`}
/>

## Variants

Prop `variant` toggles between histograms displaying counts and densities.

<Canvas>
    <Story
        name="counts"
        args={{
            variant: 'count',
            data: sampleData,
            breaks: 12,
            scaleX: {
                variant: 'linear',
                domain: ['auto', 'auto'],
            },
            scaleY: {
                variant: 'linear',
                domain: 'auto',
            },
            children: (
                <>
                    <Axis variant={'bottom'} label={'x (a.u.)'} />
                    <Axis variant={'left'} label={'counts'} />
                    <HistogramArea style={{ fillOpacity: 1 }} />
                </>
            ),
        }}
        component={Histogram}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
    <Story
        name="densities"
        args={{
            variant: 'density',
            data: sampleData,
            breaks: 12,
            scaleX: {
                variant: 'linear',
                domain: 'auto',
            },
            scaleY: {
                variant: 'linear',
                domain: 'auto',
            },
            children: (
                <>
                    <Axis variant={'bottom'} label={'x (a.u.)'} />
                    <Axis variant={'left'} label={'density'} />
                    <HistogramArea style={{ fillOpacity: 1 }} />
                </>
            ),
        }}
        component={Histogram}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

## Breaks

All histograms are generated by first placing raw data values into discrete bins. The number and size of those bins is controlled via prop `breaks`.

Prop `breaks` can be set to a integer, and in this case the value is taken as a suggested number of bins. The examples below display the same datasets using low and high bin resolution.

<Canvas>
    <Story
        name="low resolution"
        args={{
            data: sampleData,
            breaks: 5,
            children: (
                <>
                    <Axis variant={'bottom'} label={'x (a.u.)'} />
                    <Axis variant={'left'} label={'counts'} />
                    <HistogramCurve curve="Step" style={{ fillOpacity: 0, strokeWidth: 3 }} />
                </>
            ),
        }}
        component={Histogram}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
    <Story
        name="high resolution"
        args={{
            data: sampleData,
            breaks: 40,
            children: (
                <>
                    <Axis variant={'bottom'} label={'x (a.u.)'} />
                    <Axis variant={'left'} label={'counts'} />
                    <HistogramCurve curve="Step" style={{ fillOpacity: 0, strokeWidth: 3 }} />
                </>
            ),
        }}
        component={Histogram}
        decorators={[ChartDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

Prop `breaks` can also accept a list of breakpoints. Note that data outside of the defined breakpoints will be omitted.

## Axis scaling

When the vertical scale is determined automatically, prop `autoRescale` determines whether the automatic configuration is re-calculated when certain data series toggle in and out of view.

The examples below have automatic rescaling turned on (first example) and off (second example). Click on the legend to toggle visibility of the data series and observe the scale on the vertical axis.

export const AreaAndLegend = () => {
    return (
        <>
            <Axis variant={'bottom'} label={'x (a.u.)'} />
            <Axis variant={'left'} label={'counts'} />
            <HistogramArea style={{ fillOpacity: 1 }} />
            <Legend
                position={[220, 60]}
                positionUnits={'absolute'}
                anchor={[0, 0.5]}
                title={'Distributions'}
            />
        </>
    )
}

<Canvas>
    <Story
        name="auto-rescaling"
        args={{
            data: sampleData,
            breaks: 12,
            scaleX: {
                variant: 'linear',
                domain: ['auto', 'auto'],
            },
            scaleY: {
                variant: 'linear',
                domain: 'auto',
            },
            autoRescale: true,
            children: <AreaAndLegend />,
        }}
        component={Histogram}
        decorators={[ChartWithLegendSpaceDecorator]}
    >
        {Template.bind({})}
    </Story>
    <Story
        name="fixed scales"
        args={{
            data: sampleData,
            breaks: 12,
            scaleX: {
                variant: 'linear',
                domain: 'auto',
            },
            scaleY: {
                variant: 'linear',
                domain: 'auto',
            },
            autoRescale: false,
            children: <AreaAndLegend />,
        }}
        component={Histogram}
        decorators={[ChartWithLegendSpaceDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>
